# Общие сведения о Cloud Pub/Sub

<walkthrough-tutorial-url url="https://cloud.google.com/pubsub/quickstart-console"></walkthrough-tutorial-url></walkthrough-test-start-page>

<walkthrough-devshell-precreate></walkthrough-devshell-precreate>

## Введение

Cloud Pub/Sub – управляемый сервис, который позволяет обмениваться сообщениями между независимыми приложениями в режиме реального времени. Из этого руководства вы узнаете, как использовать интерфейс командной строки Cloud Pub/Sub и команду `gcloud`.

## Настройка проекта

В проекте будут собраны все ресурсы, которые вы используете в своем приложении.

Без проекта настроить сообщения нельзя.

<walkthrough-project-setup></walkthrough-project-setup>

## Создание первой темы

### Запуск Google Cloud Shell

Cloud Shell – это встроенный интерфейс командной строки для Google Cloud Console. Именно в нем мы и настроим Cloud Pub/Sub.

Откройте Cloud Shell. Для этого нажмите <walkthrough-cloud-shell-icon></walkthrough-cloud-shell-icon>[значок][spotlight-open-devshell] на панели навигации в верхней части консоли.

### Создание темы

Тема – это именованный ресурс, на который вы будете отправлять сообщения. Чтобы создать тему, выполните следующую команду:

```bash
gcloud pubsub topics create my-topic
```

## Добавление подписки

Чтобы получать сообщения, нужны подписки, каждой из которых должна соответствовать определенная тема. Создайте первую подписку, выполнив следующую команду:

```bash
gcloud pubsub subscriptions \
    create my-sub --topic my-topic \
    --ack-deadline=60
```

Данная команда создает подписку с названием `my-sub`, связанную с темой `my-topic`. По ней будут доставляться все опубликованные сообщения на указанную тему.``

Обратите внимание на параметр `--ack-deadline=60`. Значение `ack-deadline` определяет `срок получения подтверждения`. Соответственно, в нашей подписке `срок получения подтверждения` составляет 60 секунд. Подробнее мы объясним это позже.

## Получение списка тем и подписок

Перед отправкой первого сообщения просмотрите список всех тем и подписок, чтобы убедиться, что предыдущие операции завершились успешно. Для этого выполните следующую команду:

```bash
gcloud pubsub topics list
```

```bash
gcloud pubsub subscriptions list
```

## Публикация сообщений в теме

Отправьте два сообщения, выполнив следующие команды:

```bash
gcloud pubsub topics publish my-topic --message hello
```

```bash
gcloud pubsub topics publish my-topic --message goodbye
```

Каждая из этих команд служит для отправки сообщения. Первое из них – `hello`, а второе – `goodbye`. Если команда будет выполнена успешно, вы увидите уникальный идентификатор, который сервер назначает для каждого сообщения.

## Извлечение сообщений из подписки

### Извлечение сообщений

Извлеките опубликованные сообщения, выполнив следующую команду:

```bash
gcloud pubsub subscriptions \
    pull --auto-ack --limit=2 my-sub
```

Вы должны увидеть два сообщения – `hello` и `goodbye`, а также `MESSAGE_ID`, уникальный идентификатор сообщения, назначенный сервером.``

Учтите, что Cloud Pub/Sub не гарантирует отображение всех опубликованных сообщений в нужном порядке. Кроме того, вы можете увидеть только одно из них. Чтобы отобразилось второе, выполните команду несколько раз.

### Подтверждение получения и срок подтверждения

Получив и обработав сообщение, вы должны направить Cloud Pub/Sub соответствующее **подтверждение**.

Наверное, вы заметили флаг `--auto-ack` в команде `pull` –
он как раз и ``служит для автоматического извлечения и подтверждения сообщения.

## Подтверждение вручную

### Отправьте новое сообщение

Выполните следующую команду:

```bash
gcloud pubsub \
    topics publish my-topic --message thanks
```

### Извлеките сообщения ещё раз

Выполните следующую команду:

```bash
gcloud pubsub subscriptions \
    pull my-sub
```

Вот что вы должны увидеть на экране: сообщение `thanks`, `MESSAGE_ID` и `ACK_ID`. ``Последний параметр содержит ещё один идентификатор, который можно использовать для подтверждения сообщения.

### Подтвердите сообщение

Полученное сообщение необходимо подтвердить, пока не истек **срок подтверждения**. Например, если настроенный для подписки срок**** составляет 60 секунд, подтверждение необходимо отправить в течение минуты. Если этого не сделать, Cloud Pub/Sub отправит сообщение ещё раз.

Чтобы подтвердить сообщение, выполните следующую команду (вместо `ACK_ID` укажите фактический идентификатор):

```bash
gcloud pubsub subscriptions ack \
    my-sub --ack-ids ACK_ID
```

## Просмотр темы и подписки в интерфейсе пользователя Pub/Sub

Итак, мы рассмотрели использование командной строки `gcloud`, а теперь обратимся к веб-интерфейсу Google Cloud Console.

Темы и подписки можно просмотреть в разделе Pub/Sub.

### Откройте раздел Pub/Sub

Откройте [меню][spotlight-console-menu] в левой части консоли.

Выберите раздел **Pub/Sub**.

<walkthrough-menu-navigation sectionid="CLOUDPUBSUB_SECTION"></walkthrough-menu-navigation>

В этом интерфейсе также можно создавать темы и подписки и управлять ими.

### Удалите тему

Установите флажок напротив созданной темы и нажмите [Удалить][spotlight-delete-button]. Восстановить тему будет невозможно.

## Заключение

Поздравляем!

<walkthrough-conclusion-trophy></walkthrough-conclusion-trophy>

Вы познакомились с интерфейсом командной строки `gcloud` и интерфейсом пользователя Cloud Pub/Sub. Теперь вы можете создавать собственные приложения! Подробнее о Pub/Sub можно узнать [здесь][pubsub-docs].

Дополнительная информация:

[Примеры кода](https://cloud.google.com/pubsub/docs/quickstart-client-libraries)

[pubsub-docs]: https://cloud.google.com/pubsub/docs/
[spotlight-console-menu]: walkthrough://spotlight-pointer?spotlightId=console-nav-menu
[spotlight-delete-button]: walkthrough://spotlight-pointer?cssSelector=.p6n-icon-delete
[spotlight-open-devshell]: walkthrough://spotlight-pointer?spotlightId=devshell-activate-button
